#!/bin/bash

MAC=$1
NAME=$2
L1=$3
GRIDREADY=$4
REDISHOST=$5

redis-cli -h $REDISHOST ZREM l2:wait $NAME
redis-cli -h $REDISHOST ZADD l2:rat $(date +%s) $NAME

if rat $MAC/$NAME.mac -l rat.$NAME.log
then
  mv /home/trigger/BufferScripts/$NAME.l2.root $GRIDREADY/SNOP_$NAME.l2.root
  rm $MAC/$NAME.mac
  mv $L1 /raid/data/$L1
  redis-cli -h $REDISHOST ZREM l2:rat $NAME
  redis-cli -h $REDISHOST ZADD l2:done $(date +%s) $NAME
else
  redis-cli -h $REDISHOST ZREM l2:rat $NAME
  redis-cli -h $REDISHOST ZADD l2:fail $(date +%s) $NAME
fi
